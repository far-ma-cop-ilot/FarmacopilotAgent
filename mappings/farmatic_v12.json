{
  "version": "12.x",
  "erp": "farmatic",
  "description": "Mapping para Farmatic versión 12.x (Oracle Database - nomenclatura modernizada)",
  "database_type": "oracle",
  "tables": {
    "ventas": {
      "source_table": "VEN_DETALLE",
      "columns": [
        {
          "source": "FECHA",
          "target": "fecha",
          "type": "date"
        },
        {
          "source": "ARTICULO_ID",
          "target": "codigo_producto",
          "type": "number"
        },
        {
          "source": "DESCRIPCION",
          "target": "nombre_producto",
          "type": "varchar2",
          "from_join": "ART_MAESTRO"
        },
        {
          "source": "CANTIDAD",
          "target": "cantidad",
          "type": "number"
        },
        {
          "source": "PVP_UNITARIO",
          "target": "precio_unitario",
          "type": "number"
        },
        {
          "source": "IMPORTE",
          "target": "importe_total",
          "type": "number"
        },
        {
          "source": "TIPO",
          "target": "tipo_venta",
          "type": "varchar2"
        },
        {
          "source": "RECETA_NUM",
          "target": "numero_receta",
          "type": "varchar2"
        },
        {
          "source": "CN",
          "target": "codigo_nacional",
          "type": "varchar2"
        },
        {
          "source": "DTO",
          "target": "descuento",
          "type": "number"
        },
        {
          "source": "IVA_PCT",
          "target": "iva",
          "type": "number"
        },
        {
          "source": "TICKET_ID",
          "target": "id_ticket",
          "type": "number"
        }
      ],
      "incremental_column": "FECHA",
      "joins": [
        {
          "table": "ART_MAESTRO",
          "alias": "a",
          "on": "v.ARTICULO_ID = a.ID",
          "type": "INNER"
        }
      ],
      "query_template": "SELECT {columns} FROM {table} v INNER JOIN ART_MAESTRO a ON v.ARTICULO_ID = a.ID WHERE {incremental_column} > :lastExport ORDER BY {incremental_column} ASC"
    },
    "stock": {
      "source_table": "STK_ACTUAL",
      "columns": [
        {
          "source": "ARTICULO_ID",
          "target": "codigo_producto",
          "type": "number"
        },
        {
          "source": "UNIDADES",
          "target": "stock_actual",
          "type": "number"
        },
        {
          "source": "MINIMO",
          "target": "stock_minimo",
          "type": "number"
        },
        {
          "source": "FECHA_ULT_MOV",
          "target": "fecha_actualizacion",
          "type": "date"
        }
      ],
      "incremental_column": "FECHA_ULT_MOV",
      "query_template": "SELECT {columns} FROM {table} WHERE {incremental_column} > :lastExport ORDER BY {incremental_column} ASC"
    },
    "compras": {
      "source_table": "COM_DETALLE",
      "columns": [
        {
          "source": "FECHA",
          "target": "fecha",
          "type": "date"
        },
        {
          "source": "ARTICULO_ID",
          "target": "codigo_producto",
          "type": "number"
        },
        {
          "source": "CANTIDAD",
          "target": "cantidad",
          "type": "number"
        },
        {
          "source": "PRECIO_COMPRA",
          "target": "precio_coste",
          "type": "number"
        },
        {
          "source": "PROVEEDOR_ID",
          "target": "codigo_proveedor",
          "type": "number"
        },
        {
          "source": "ALBARAN",
          "target": "numero_albaran",
          "type": "varchar2"
        }
      ],
      "incremental_column": "FECHA",
      "query_template": "SELECT {columns} FROM {table} WHERE {incremental_column} > :lastExport ORDER BY {incremental_column} ASC"
    }
  },
  "notes": {
    "connection_string_format": "Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=localhost)(PORT=1521))(CONNECT_DATA=(SERVICE_NAME=FARMATIC12)));User Id=FARMACIA;Password=password;",
    "tns_names_location": "C:\\oracle\\product\\12.2.0\\client_1\\network\\admin\\tnsnames.ora",
    "key_differences_from_v11": [
      "Nomenclatura simplificada (VEN_DETALLE vs VENTAS_DETALLE)",
      "IDs numéricos en lugar de códigos alfanuméricos",
      "ART_MAESTRO en lugar de ARTICULOS",
      "Campos más cortos y abreviados"
    ],
    "common_issues": [
      "Oracle 12c requiere configuración diferente de TNS",
      "Permisos de usuario pueden ser más restrictivos",
      "Tablas pueden tener prefijos personalizados por instalación"
    ]
  }
}
